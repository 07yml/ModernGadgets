[Rainmeter]
Update=#gadgetUpdateRate#
MiddleMouseDownAction=[!Refresh]
MouseOverAction=[!ToggleMeterGroup ConfigButton][!UpdateMeterGroup Background][!Redraw]
MouseLeaveAction=[!ToggleMeterGroup ConfigButton][!UpdateMeterGroup Background][!Redraw]
LeftMouseDoubleClickAction=["taskmgr.exe"]
Group=ModernGadgets | MgGlobalRefresh | MgImportRefresh
AccurateText=1

; Custom Context Menu
ContextTitle=CPU Meter settings
ContextAction=[!ActivateConfig "ModernGadgets\Config\CPU" "Config.ini"]
ContextTitle2=Global settings
ContextAction2=[!ActivateConfig "ModernGadgets\Config\Global" "Config.ini"]
ContextTitle3=Gadget manager
ContextAction3=[!ActivateConfig "ModernGadgets\Config\GadgetManager" "Config.ini"]

[Metadata]
Name=CPU
Author=raiguard
Information=A Rainmeter recreation of the All CPU Meter gadget, updated and enhanced to give it a "modern" feel.
License=Creative Commons BY-NC-SA 3.0
Version=1.4.0-beta.2

[Variables]
@includeStyleSheet=#@#StyleSheet.inc
@includeGlobalSettings=#@#Settings\GlobalSettings.inc
@includeCpuSettings=#@#Settings\CpuSettings.inc

cpuMaxTemp=30 + 70
extProgram=0
speedFanRef=10
sfCoreTempOffset=10
sfCpuFan=1

threadsPerCore=2
cpuCores=2
updateSettings=0

textRamUsed=""
textRamTotal=""

textPageUsed=""
textPageTotal=""

[StyleStringCoreTemps]
X=(((#showCoreVoltages# = 1) && (#extProgram# = 1)) ? (#contentMargin# + (#contentWidth# / 3) + ((#cpuCores# > 9) ? 7 : 2)) : #contentMarginCenter#)
DynamicVariables=1

[StyleStringCoreVoltages]
X=((#showCoreTemps# = 1) ? (#contentMargin# + ((#contentWidth# / 3) * 2)) : #contentMarginCenter#) 
NumOfDecimals=3
Text="%1 V"
DynamicVariables=1

; ========= Measures =========

[MeasureFixedPrecisionFormatScript]
Measure=Script
ScriptFile=#scriptPath#FixedPrecisionFormat.lua

[MeasureCpuConfigScript]
Measure=Script
ScriptFile=#scriptPath#Config\CpuConfig.lua

; ----- CPU Name -----

[MeasureCpuName]
Measure=Registry
RegHKey=HKEY_LOCAL_MACHINE
RegKey=HARDWARE\DESCRIPTION\System\CentralProcessor\0
RegValue=ProcessorNameString
UpdateDivider=-1
Disabled=(#showCpuName# = 0)
Group=CpuName

[MeasureCpuDisplayName]
Measure=Registry
RegHKey=HKEY_LOCAL_MACHINE
RegKey=HARDWARE\DESCRIPTION\System\CentralProcessor\0
RegValue=ProcessorNameString
RegExpSubstitute=1
SubStitute="\(R\)":"","\(TM\)":"","\(tm\)":"","(.*) CPU.*":"\1"
UpdateDivider=-1
Disabled=(#showCpuName# = 0)
Group=CpuName

[MeasureCpuCustomDisplayName]
Measure=String
String=#cpuName#
IfMatch=auto
IfNotMatchAction=[!SetOption MeterCpuDisplayName Text "#*cpuName*#"][!UpdateMeter MeterCpuDisplayName]
Disabled=(#showCpuName# = 0)

; ----- RAM Info -----

[MeasureRamUsed]
Measure=PhysicalMemory
IfCondition=1
IfTrueAction=[!SetVariable textRamUsed [&MeasureFixedPrecisionFormatScript:FormatNumber([&MeasureRamUsed],[#fpfRamDepth],'1k')]]
OnChangeAction=[!SetVariable textRamUsed [&MeasureFixedPrecisionFormatScript:FormatNumber([&MeasureRamUsed],[#fpfRamDepth],'1k')]]

[MeasureRamTotal]
Measure=PhysicalMemory
Total=1
UpdateDivider=-1
IfCondition=1
IfTrueAction=[!SetVariable textRamTotal [&MeasureFixedPrecisionFormatScript:FormatNumber([&MeasureRamTotal],1,'1k')]]

[MeasureRamUsage]
Measure=Calc
Formula=(MeasureRamUsed / MeasureRamTotal) * 100
MinValue=0
MaxValue=100

; ----- Page/Swap Info -----

[Measure4KPagesInUse]
Measure=Plugin
Plugin=PerfMon
PerfMonObject=Paging File
PerfMonCounter=% Usage
PerfMonInstance=_Total
PerfMonDifference=0
Group=CpuPage
Disabled=(#showPageFile# = 0)

[MeasurePageUsed]
Measure=Calc
Formula=Measure4KPagesInUse * 4096
IfCondition=1
IfTrueAction=[!SetVariable textPageUsed [&MeasureFixedPrecisionFormatScript:FormatNumber([&MeasurePageUsed],[#fpfPageDepth],'1k')]]
OnChangeAction=[!SetVariable textPageUsed [&MeasureFixedPrecisionFormatScript:FormatNumber([&MeasurePageUsed],[#fpfPageDepth],'1k')]]
Group=CpuPage
Disabled=(#showPageFile# = 0)

[MeasurePageTotal]
Measure=SwapMemory
Total=1
Group=CpuPage
Disabled=(#showPageFile# = 0)

[MeasurePageTotalCalc]
Measure=Calc
Formula=MeasurePageTotal-MeasureRamTotal
IfCondition=1
IfTrueAction=[!SetVariable textPageTotal [&MeasureFixedPrecisionFormatScript:FormatNumber([&MeasurePageTotalCalc],1,'1k')]]
Group=CpuPage
Disabled=(#showPageFile# = 0)

[MeasurePageUsage]
Measure=Calc
Formula=(MeasurePageUsed / MeasurePageTotalCalc) * 100
MinValue=0
MaxValue=100
Group=CpuPage
Disabled=(#showPageFile# = 0)

; ----- Fan Info -----

[MeasureCpuFanSpeed]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-MOBO-CPUFan-SensorId#
HWiNFOSensorInstance=#HWiNFO-MOBO-CPUFan-SensorInstance#
HWiNFOEntryId=#HWiNFO-MOBO-CPUFan-EntryId#
HWiNFOType=CurrentValue
HWiNFOLogHandler=2
Group=CpuFan | ProgramSwitching | HWiNFO
Disabled=(#showCpuFan# = 0) || (#extProgram# <> 1)

[MeasureCpuFanSpeedSpeedFan]
Measure=Plugin
Plugin=SpeedFanPlugin
SpeedFanType=Fan
SpeedFanNumber=#sfCpuFan#
Group=CpuFan | ProgramSwitching | SpeedFan | CoreTempSpeedFan
Disabled=(#showCpuFan# = 0) || ((#extProgram# <> 4) && (#extProgram# <> 6))

; ----- CPU Cores -----

; General Cpu Information
[MeasureCpuThreadsPerCore]
;Measure=Plugin
;Plugin=ActiveNet
;Type=ThreadsPerCore
Measure=Calc
Formula=2
DynamicVariables=1
UpdateDivider=-1
IfCondition=(MeasureCpuThreadsPerCore <> #threadsPerCore#)
IfTrueAction=[!WriteKeyValue Variables threadsPerCore [MeasureCpuThreadsPerCore:]][!Refresh]

[MeasureCpuLogicalCores]
Measure=Calc
; Formula=%NUMBER_OF_PROCESSORS%
Formula=2
IfCondition=(MeasureCpuLogicalCores <> #cpuCores#)
IfTrueAction=[!WriteKeyValue Variables cpuCores [MeasureCpuLogicalCores:]][!WriteKeyValue Variables threadCount [MeasureCpuLogicalCores:] "#cpuSettingsPath#"][!Refresh][!Refresh "ModernGadgets\Config\CPU"]
DynamicVariables=1

[MeasureCpuPhysicalCores]
Measure=Calc
Formula=(MeasureCpuLogicalCores / MeasureCpuThreadsPerCore)

[MeasureCpuIdentifier]
Measure=Registry
RegHKey=HKEY_LOCAL_MACHINE
RegKey=HARDWARE\DESCRIPTION\System\CentralProcessor\0
RegValue=Identifier
UpdateDivider=-1

[MeasureCpuVendorIdentifier]
Measure=Registry
RegHKey=HKEY_LOCAL_MACHINE
RegKey=HARDWARE\DESCRIPTION\System\CentralProcessor\0
RegValue=ProcessorNameString
;Measure=String
;String=Snapdragon
UpdateDivider=-1
IfMatch=(.*Intel.*)
IfMatchAction=[!SetOption MeterCpuIcon ImageTint "#colorIntel#"][!UpdateMeter MeterCpuIcon]
IfMatch2=(.*AMD.*)
IfMatchAction2=[!SetOption MeterCpuIcon ImageName "#imgPath#amd.png"][!SetOption MeterCpuIcon X "(#*contentMargin*# + 1)"][!SetOption MeterCpuIcon Y "(#*contentMargin*# + 1)"][!SetOption MeterCpuIcon W "11"][!SetOption MeterCpuIcon H "11"][!UpdateMeter MeterCpuIcon]
IfMatch3=(.*Snapdragon.*)
IfMatchAction3=[!SetOption MeterCpuIcon ImageTint "#colorSnapdragon#"][!UpdateMeter MeterCpuIcon]

; Core Usages
[MeasureCpuUsageCore1]
Measure=CPU
Processor=1
Disabled=(#cpuCores# < 1)

[MeasureCpuUsageCore2]
Measure=CPU
Processor=2
Disabled=(#cpuCores# < 2)

[MeasureCpuUsage]
Measure=CPU

; Core Temperatures
; __ HWiNFO
[MeasureCpuTempHwinfoCore1]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-CPU0-Core0Temp-SensorId#
HWiNFOSensorInstance=#HWiNFO-CPU0-Core0Temp-SensorInstance#
HWiNFOEntryId=#HWiNFO-CPU0-Core0Temp-EntryId#
HWiNFOType=CurrentValue
IfCondition=MeasureCpuThreadsPerCore = 1
IfTrueAction=[!SetOption MeterCore1Temp MeasureName "MeasureCpuTempHwinfoCore1"][!UpdateMeter MeterCore1Temp]
Group=CoreTemps | HWiNFO | ProgramSwitching
Disabled=((#showCoreTemps# = 0) || (#cpuCores# / #threadsPerCore# < 1)) || (#extProgram# = 0) || (#extProgram# = 2) || (#extProgram# = 4) || (#extProgram# = 6)

[MeasureCpuTempHwinfoCore2]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-CPU0-Core1Temp-SensorId#
HWiNFOSensorInstance=#HWiNFO-CPU0-Core1Temp-SensorInstance#
HWiNFOEntryId=#HWiNFO-CPU0-Core1Temp-EntryId#
HWiNFOType=CurrentValue
IfCondition=MeasureCpuThreadsPerCore = 1
IfTrueAction=[!SetOption MeterCore2Temp MeasureName "MeasureCpuTempHwinfoCore2"][!UpdateMeter MeterCore2Temp]
Group=CoreTemps | HWiNFO | ProgramSwitching
Disabled=((#showCoreTemps# = 0) || (#cpuCores# / #threadsPerCore# < 2)) || (#extProgram# = 0) || (#extProgram# = 2) || (#extProgram# = 4) || (#extProgram# = 6)

; __ CoreTemp
[MeasureCpuTempCoreTempCore1]
Measure=Plugin
Plugin=CoreTemp
CoreTempType=Temperature
CoreTempIndex=0
IfCondition=MeasureCpuThreadsPerCore = 1
IfTrueAction=[!SetOption MeterCore1Temp MeasureName "MeasureCpuTempCoreTempCore1"][!UpdateMeter MeterCore1Temp]
MinValue=0
MaxValue=#cpuMaxTemp#
Group=CoreTemps | ProgramSwitching
Disabled=((#showCoreTemps# = 0) || (#cpuCores# / #threadsPerCore# < 1)) || ((#extProgram# <> 2) && (#extProgram# <> 6))

; __ SpeedFan
[MeasureCpuTempSpeedFanCore1]
Measure=Plugin
Plugin=SpeedFanPlugin
SpeedFanType=Temperature
SpeedFanNumber=#speedFanRef# + 0
IfCondition=MeasureCpuThreadsPerCore = 1
IfTrueAction=[!SetOption MeterCore1Temp MeasureName "MeasureCpuTempSpeedFanCore1"][!UpdateMeter MeterCore1Temp]
MinValue=0
MaxValue=#cpuMaxTemp#
Group=CoreTemps | ProgramSwitching
Disabled=((#showCoreTemps# = 0) || (#cpuCores# / #threadsPerCore# < 1)) || (#extProgram# <> 4)

; Core Voltages
[MeasureCpuVoltageCore1]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-CPU0-Core0Vid-SensorId#
HWiNFOSensorInstance=#HWiNFO-CPU0-Core0Vid-SensorInstance#
HWiNFOEntryId=#HWiNFO-CPU0-Core0Vid-EntryId#
HWiNFOType=CurrentValue
IfCondition=MeasureCpuThreadsPerCore = 1
IfTrueAction=[!SetOption MeterCore1Voltage MeasureName "MeasureCpuVoltageCore1"][!UpdateMeter MeterCore1Voltage]
Group=CoreVoltages | ProgramSwitching
Disabled=((#showCoreVoltages# = 0) || (#cpuCores# / #threadsPerCore# < 1)) || (#extProgram# = 0) || (#extProgram# = 2) || (#extProgram# = 4) || (#extProgram# = 6)

[MeasureCpuVoltageCore2]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-CPU0-Core1Vid-SensorId#
HWiNFOSensorInstance=#HWiNFO-CPU0-Core1Vid-SensorInstance#
HWiNFOEntryId=#HWiNFO-CPU0-Core1Vid-EntryId#
HWiNFOType=CurrentValue
IfCondition=MeasureCpuThreadsPerCore = 1
IfTrueAction=[!SetOption MeterCore2Voltage MeasureName "MeasureCpuVoltageCore2"][!UpdateMeter MeterCore2Voltage]
Group=CoreVoltages | ProgramSwitching
Disabled=((#showCoreVoltages# = 0) || (#cpuCores# / #threadsPerCore# < 2)) || (#extProgram# = 0) || (#extProgram# = 2) || (#extProgram# = 4) || (#extProgram# = 6)

; ----- Package Temperature and TjMax -----

[MeasureCpuTempHwinfoPackage]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-CPU0-PackageTemp-SensorId#
HWiNFOSensorInstance=#HWiNFO-CPU0-PackageTemp-SensorInstance#
HWiNFOEntryId=#HWiNFO-CPU0-PackageTemp-EntryId#
HWiNFOType=CurrentValue
Group=ProgramSwitching | HWiNFO
MinValue=0
MaxValue=#cpuMaxTemp#
Disabled=(#showCpuTempGraph# = 0) || (#extProgram# = 0) || (#extProgram# = 2) || (#extProgram# = 4) || (#extProgram# = 6)

[MeasureCpuTempHwinfoTjMax]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-CPU0-Core0TjMax-SensorId#
HWiNFOSensorInstance=#HWiNFO-CPU0-Core0TjMax-SensorInstance#
HWiNFOEntryId=#HWiNFO-CPU0-Core0TjMax-EntryId#
HWiNFOType=CurrentValue
IfCondition=(MeasureCpuTempHwinfoCore1 + MeasureCpuTempHwinfoTjMax) <> #cpuMaxTemp#
IfTrueAction=[!SetVariable cpuMaxTemp "[&MeasureCpuTempHwinfoCore1:] + [&MeasureCpuTempHwinfoTjMax:]"][!WriteKeyValue Variables cpuMaxTemp "[&MeasureCpuTempHwinfoCore1:] + [&MeasureCpuTempHwinfoTjMax:]"][!UpdateMeasure MeasureCpuTempHwinfoPackage]
Group=TjMax | ProgramSwitching | HWiNFO
Disabled=(#showCpuTempGraph# = 0) || (#extProgram# <> 1)

[MeasureCpuTempCoreTempTjMax]
Measure=Plugin
Plugin=CoreTemp
CoreTempType=TjMax
CoreTempIndex=0
IfCondition=MeasureCpuTempCoreTempTjMax <> #cpuMaxTemp#
IfTrueAction=[!SetVariable cpuMaxTemp "[&MeasureCpuTempCoreTempTjMax:]"][!WriteKeyValue Variables cpuMaxTemp "[&MeasureCpuTempCoreTempTjMax:]"][!UpdateMeasure MeasureCpuTempCoreTempCore1]
Disabled=(#showCpuTempGraph# = 0) || ((#extProgram# <> 2) && (#extProgram# <> 6))

[MeasureCpuTt]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-CPU0-PackageTt-SensorId#
HWiNFOSensorInstance=#HWiNFO-CPU0-PackageTt-SensorInstance#
HWiNFOEntryId=#HWiNFO-CPU0-PackageTt-EntryId#
HWiNFOType=CurrentValue
Group=Tt | ProgramSwitching | HWiNFO
Disabled=(#showTt# = 0) || (#extProgram# <> 1)

[MeasureCpuTtCalc]
Measure=Calc
Formula=MeasureCpuTt * #showTt#
; Formula=1 * #showTt#
IfCondition=(MeasureCpuTtCalc > 0) && (#playTtSound# = 1)
IfTrueAction=PlayLoop "#ttSoundPath#"
IfCondition2=(MeasureCpuTtCalc > 0)
IfTrueAction2=[!ShowMeter TtWarningString][!UpdateMeterGroup Background][!Redraw]
IfCondition3=(MeasureCpuTtCalc = 0) || (#playTtSound# = 0) || (#showTt# = 0)
IfTrueAction3=PlayStop
IfCondition4=(MeasureCpuTtCalc = 0)
IfTrueAction4=[!HideMeter TtWarningString][!UpdateMeterGroup Background]
MaxValue=1
DynamicVariables=1
Group=Tt
Disabled=(#showTt# = 0) || (#extProgram# <> 1)

; ----- CPU Clock Speed -----

[MeasureCpuClockSpeed]
Measure=Plugin
Plugin=PowerPlugin
PowerState=MHz
Group=CpuClock | ProgramSwitching | NoProgram
Disabled=(#showCpuClock# = 0) || ((#extProgram# <> 4) && (#extProgram# > 0))

[MeasureCpuClockSpeedHwinfo]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-CPU0-RingClock-SensorId#
HWiNFOSensorInstance=#HWiNFO-CPU0-RingClock-SensorInstance#
HWiNFOEntryId=#HWiNFO-CPU0-RingClock-EntryId#
HWiNFOType=CurrentValue
Group=CpuClock | ProgramSwitching | Hwinfo
Disabled=(#showCpuClock# = 0) || (#extProgram# <> 1)

[MeasureCpuClockSpeedCoreTemp]
Measure=Plugin
Plugin=CoreTemp
CoreTempType=CpuSpeed
Group=CpuClock | ProgramSwitching | CoreTemp | CoreTempSpeedFan
Disabled=(#showCpuClock# = 0) || ((#extProgram# <> 2) && (#extProgram# <> 6))

; ----- Top Process -----

[MeasureTopProcess]
Measure=Plugin
Plugin=UsageMonitor
Alias=CPU
Index=1
Substitute="":"---"

; ----- Program Detection -----

[MeasureHwinfoDetect]
Measure=Plugin
Plugin=HWiNFO
HWiNFOSensorId=#HWiNFO-CPU0-Core0Temp-SensorId#
HWiNFOSensorInstance=#HWiNFO-CPU0-Core0Temp-SensorInstance#
HWiNFOEntryId=#HWiNFO-CPU0-Core0Temp-EntryId#
HWiNFOLogHandler=2
HWiNFOType=CurrentValue

[MeasureCoreTempDetect]
Measure=Plugin
Plugin=CoreTemp
CoreTempType=Temperature
CoreTempIndex=0

[MeasureSpeedFanDetect]
Measure=Plugin
Plugin=SpeedFanPlugin
SpeedFanType=Temperature
SpeedFanNumber=#speedFanRef# + 0

; Sets measures and meters depending on the active state of each external program
[MeasureCalcExtProgramSources]
Measure=Calc
Formula=((MeasureHwinfoDetect < 0) ? 0 : 1) + ((MeasureCoreTempDetect = 0) ? 0 : 2) + ((MeasureSpeedFanDetect = 0) ? 0 : 4)
; No program
IfCondition=(MeasureCalcExtProgramSources = 0) && (#extProgram# <> 0)
IfTrueAction=[!Log "No program running"][!SetVariable extProgram 0][!WriteKeyValue Variables extProgram 0][!DisableMeasureGroup ProgramSwitching][!EnableMeasureGroup NoProgram][!UpdateMeasureGroup NoProgram][!UpdateMeterGroup CpuFan][!SetOption MeterCpuClockValue Text "%1 MHz"][!UpdateMeterGroup CpuClock][!UpdateMeterGroup LineGraph][!UpdateMeterGroup Background][!Redraw]
;IfTrueAction=[!SetVariable extProgram 0][!WriteKeyValue Variables extProgram 0][!UpdateMeasureGroup ProgramSwitching][!UpdateMeterGroup ProgramSwitching][!Redraw]
; HWiNFO only
IfCondition2=((MeasureCalcExtProgramSources = 1) || (MeasureCalcExtProgramSources = 3) || (MeasureCalcExtProgramSources = 5) || (MeasureCalcExtProgramSources = 7)) && (#extProgram# <> 1)
IfTrueAction2=[!SetVariable extProgram 1][!WriteKeyValue Variables extProgram 1][!DisableMeasureGroup ProgramSwitching][!EnableMeasureGroup HWiNFO][!CommandMeasure MeasureCpuConfigScript "ToggleTemps('Hwinfo', #cpuCores#, true)"][!CommandMeasure MeasureCpuConfigScript "ToggleVoltages(#cpuCores#, true)"][!SetOptionGroup CoreTemps Text "%1#*deg*##*tempUnits*#"][!UpdateMeterGroup CoreTemps][!SetOption MeterCpuFanValue Text "%1 RPM"][!UpdateMeterGroup CpuFan]
IfCondition3=((MeasureCalcExtProgramSources = 1) || (MeasureCalcExtProgramSources = 3) || (MeasureCalcExtProgramSources = 5) || (MeasureCalcExtProgramSources = 7))
IfTrueAction3=[!Log "HWiNFO detected"][!SetOption MeterCpuClockValue Text "%2 MHz"][!UpdateMeter MeterCpuClockValue][!UpdateMeterGroup LineGraph][!UpdateMeterGroup Background][!Redraw]
; CoreTemp only
IfCondition4=(MeasureCalcExtProgramSources = 2) && (#extProgram# <> 2)
IfTrueAction4=[!SetVariable extProgram 2][!WriteKeyValue Variables extProgram 2][!DisableMeasureGroup ProgramSwitching][!EnableMeasureGroup CoreTemp][!CommandMeasure MeasureCpuConfigScript "ToggleTemps('CoreTemp', #cpuCores#, true)"][!UpdateMeasureGroup CoreTemp]
IfCondition5=(MeasureCalcExtProgramSources = 2)
IfTrueAction5=[!Log "CoreTemp detected"][!SetOptionGroup CoreTemps Text "%2#*deg*##*tempUnits*#"][!UpdateMeterGroup CoreTemps][!SetOption MeterCpuClockValue Text "%3 MHz"][!UpdateMeterGroup CpuClock][!UpdateMeterGroup LineGraph][!UpdateMeterGroup Background][!Redraw]
; SpeedFan only
IfCondition6=(MeasureCalcExtProgramSources = 4) && (#extProgram# <> 4)
IfTrueAction6=[!SetVariable extProgram 4][!WriteKeyValue Variables extProgram 4][!DisableMeasureGroup ProgramSwitching][!EnableMeasureGroup SpeedFan][!CommandMeasure MeasureCpuConfigScript "ToggleTemps('SpeedFan', #cpuCores#, true)"][!UpdateMeasureGroup SpeedFan][!UpdateMeterGroup Background][!Redraw]
IfCondition7=(MeasureCalcExtProgramSources = 4)
IfTrueAction7=[!Log "SpeedFan detected"][!SetOptionGroup CoreTemps Text "%3#*deg*##*tempUnits*#"][!UpdateMeterGroup CoreTemps][!SetOption MeterCpuFanValue Text "%2 RPM"][!UpdateMeterGroup CpuFan][!UpdateMeterGroup LineGraph][!UpdateMeterGroup Background][!Redraw]
; CoreTemp + SpeedFan
IfCondition8=(MeasureCalcExtProgramSources = 6) && (#extProgram# <> 6)
IfTrueAction8=[!SetVariable extProgram 6][!WriteKeyValue Variables extProgram 6][!DisableMeasureGroup ProgramSwitching][!EnableMeasureGroup CoreTempSpeedFan][!CommandMeasure MeasureCpuConfigScript "ToggleTemps('CoreTemp', #cpuCores#, true)"][!UpdateMeasureGroup CoreTempSpeedFan]
IfCondition9=(MeasureCalcExtProgramSources = 6)
IfTrueAction9=[!Log "CoreTemp + SpeedFan detected"][!SetOptionGroup CoreTemps Text "%2#*deg*##*tempUnits*#"][!UpdateMeterGroup CoreTemps][!SetOption MeterCpuFanValue Text "%2 RPM"][!UpdateMeterGroup CpuFan][!SetOption MeterCpuClockValue Text "%3 MHz"][!UpdateMeter MeterCpuClockValue][!UpdateMeterGroup LineGraph][!UpdateMeterGroup Background][!Redraw]
DynamicVariables=1

; ========= Meters =========

[MeterBackground]
Meter=Image
MeterStyle=StyleBackground

; ----- Gadget header -----

[MeterConfigButton]
Meter=Image
MeterStyle=StyleSettingsButton | StyleImgButtonHover

[MeterCpuUsageValue]
Meter=String
MeterStyle=StyleString | StyleStringGadgetHeader
MeasureName=MeasureCpuUsage
StringAlign=Right
X=#contentMarginRight#
Text=%1%
DynamicVariables=1
Group=ConfigButton

[MeterCpuIcon]
Meter=Image
ImageName=#imgPath#cpu.png
ImageTint=#colorInfo#
X=#contentMargin#
Y=#contentMargin#
W=13
H=13
ToolTipTitle=[MeasureCpuName]
ToolTipIcon=Info
ToolTipText=[MeasureCpuIdentifier]#CRLF#Physical Cores: [MeasureCpuPhysicalCores]#CRLF#Logical Cores: [MeasureCpuLogicalCores]
Antialias=1
DynamicVariables=1
Hidden=0

[MeterCpuUsageLabel]
Meter=String
MeterStyle=StyleString | StyleStringGadgetHeader
X=4R
Text=CPU Usage:
DynamicVariables=1

;; ----- CPU Name -----

[MeterCpuDisplayName]
Meter=String
MeterStyle=StyleString | StyleStringCenterAlign
MeasureName=MeasureCpuDisplayName
Y=((#showCpuName# = 0) ? 0 : #rowSpacing#)R
W=(#contentWidth# - 4)
ClipString=1
Text=%1
Hidden=(#showCpuName# = 0)

; ----- RAM Information -----

[RamLabelString]
Meter=String
MeterStyle=StyleString
Y=(#rowSpacing# + 1)R
Text="RAM:"
Group=CpuRam

[RamFractionString]
Meter=String
MeterStyle=StyleString | StyleStringInfo
Text="#textRamUsed#B / #textRamTotal#B"
DynamicVariables=1
Group=CpuRam

[RamValueString]
Meter=String
MeterStyle=StyleString | StyleStringRightAlign
MeasureName=MeasureRamUsage
Text="%1%"
Group=CpuRam

[RamBar]
Meter=Bar
MeterStyle=StyleBar
MeasureName=MeasureRamUsage
BarColor=#colorRam#
Group=CpuRam

; ----- Page/Swap Information -----

[PageLabelString]
Meter=String
MeterStyle=StyleString
Y=((#showPageFile# = 0) ? -#barTextOffset# : #rowSpacing#)R
Text="Page:"
Group=CpuPage
Hidden=(#showPageFile# = 0)

[PageFractionString]
Meter=String
MeterStyle=StyleString | StyleStringInfo
Text="#textPageUsed#B / #textPageTotal#B"
DynamicVariables=1
Group=CpuPage
Hidden=(#showPageFile# = 0)

[PageValueString]
Meter=String
MeterStyle=StyleString | StyleStringRightAlign
MeasureName=MeasurePageUsage
Text="%1%"
Group=CpuPage
Hidden=(#showPageFile# = 0)

[PageBar]
Meter=Bar
MeterStyle=StyleBar
MeasureName=MeasurePageUsage
BarColor=#colorPage#
Group=CpuPage
Hidden=(#showPageFile# = 0)

; ----- CPU Core Information -----

; Core 1
[MeterCore1Label]
Meter=String
MeterStyle=StyleString
Y=((#cpuCores# >= 1) ? #rowSpacing# : -#barTextOffset#)R
Text=Core 1:
Group=CpuCore1
Hidden=(#cpuCores# < 1)

[MeterCore1Temp]
Meter=String
MeterStyle=StyleString | StyleStringInfo | StyleStringCoreTemps
MeasureName=MeasureCpuTempHwinfoCore1
MeasureName2=MeasureCpuTempCoreTempCore1
MeasureName3=MeasureCpuTempSpeedFanCore1
Text=%1#deg##tempUnits#
Group=CpuCore1 | CoreTemps
Hidden=(#cpuCores# < 1) || (#showCoreTemps# = 0) || (#extProgram# = 0)

[MeterCore1Voltage]
Meter=String
MeterStyle=StyleString | StyleStringInfo | StyleStringCoreVoltages
MeasureName=MeasureCpuVoltageCore1
Group=CpuCore1 | CoreVoltages
Hidden=(#cpuCores# < 1) || (#showCoreVoltages# = 0) || (#extProgram# <> 1)

[MeterCore1Value]
Meter=String
MeterStyle=StyleString | StyleStringRightAlign
MeasureName=MeasureCpuUsageCore1
Text=%1%
Group=CpuCore1
Hidden=(#cpuCores# < 1)

[MeterCore1Bar]
Meter=Bar
MeterStyle=StyleBar
MeasureName=MeasureCpuUsageCore1
BarColor=#colorCore1#
Group=CpuCore1
Hidden=(#cpuCores# < 1)

; Core 2
[MeterCore2Label]
Meter=String
MeterStyle=StyleString
Y=((#cpuCores# >= 1) ? #rowSpacing# : -#barTextOffset#)R
Text=Core 2:
Group=CpuCore2
Hidden=(#cpuCores# < 2)

[MeterCore2Temp]
Meter=String
MeterStyle=StyleString | StyleStringInfo | StyleStringCoreTemps
MeasureName=MeasureCpuTempHwinfoCore1
MeasureName2=MeasureCpuTempCoreTempCore1
MeasureName3=MeasureCpuTempSpeedFanCore1
Text=%1#deg##tempUnits#
Group=CpuCore2 | CoreTemps
Hidden=(#cpuCores# < 2) || (#showCoreTemps# = 0) || (#extProgram# = 0)

[MeterCore2Voltage]
Meter=String
MeterStyle=StyleString | StyleStringInfo | StyleStringCoreVoltages
MeasureName=MeasureCpuVoltageCore1
Group=CpuCore2 | CoreVoltages
Hidden=(#cpuCores# < 2) || (#showCoreVoltages# = 0) || (#extProgram# <> 1)

[MeterCore2Value]
Meter=String
MeterStyle=StyleString | StyleStringRightAlign
MeasureName=MeasureCpuUsageCore2
Text=%1%
Group=CpuCore2
Hidden=(#cpuCores# < 2)

[MeterCore2Bar]
Meter=Bar
MeterStyle=StyleBar
MeasureName=MeasureCpuUsageCore2
BarColor=#colorCore2#
Group=CpuCore2
Hidden=(#cpuCores# < 2)

; ----- Top Process -----

[MeterTopProcessLabel]
Meter=String
MeterStyle=StyleString
Y=((#showTopProcess# = 0) ? 0 : #rowSpacing#)R
Text=Top:
Group=TopProcess
Hidden=(#showTopProcess# = 0)

[MeterTopProcessValue]
Meter=String
MeterStyle=StyleString | StyleStringRightAlign
MeasureName=MeasureTopProcess
W=(#contentWidth# - 25)
ClipString=1
Group=TopProcess
Hidden=(#showTopProcess# = 0)

; ----- Fan Display -----

[MeterCpuFanLabel]
Meter=String
MeterStyle=StyleString
Text=Fan:
Y=(((#showCpuFan# = 0) || ((#extProgram# <> 1) && (#extProgram# <> 4) && (#extProgram# <> 6))) ? 0 : #rowSpacing#)R
Hidden=(#showCpuFan# = 0) || ((#extProgram# <> 1) && (#extProgram# <> 4) && (#extProgram# <> 6))
DynamicVariables=1
Group=CpuFan

[MeterCpuFanValue]
Meter=String
MeterStyle=StyleString | StyleStringRightAlign
MeasureName=MeasureCpuFanSpeed
MeasureName2=MeasureCpuFanSpeedSpeedFan
Text=%1 RPM
Hidden=(#showCpuFan# = 0) || ((#extProgram# <> 1) && (#extProgram# <> 4) && (#extProgram# <> 6))
DynamicVariables=1
Group=CpuFan

; ----- Clock Speed -----

[MeterCpuClockLabel]
Meter=String
MeterStyle=StyleString
Y=((#showCpuClock# = 0) ? 0 : #rowSpacing#)R
Text=Clock:
Hidden=(#showCpuClock# = 0)
Group=CpuClock

[MeterCpuClockValue]
Meter=String
MeterStyle=StyleString | StyleStringRightAlign
MeasureName=MeasureCpuClockSpeed
MeasureName2=MeasureCpuClockSpeedHwinfo
MeasureName3=MeasureCpuClockSpeedCoreTemp
Text=%1 MHz
Hidden=(#showCpuClock# = 0)
Group=CpuClock

; ----- Line Graph / Histogram -----

[MeterLineGraphBackground]
Meter=Image
MeterStyle=StyleLineGraphBackground
Y=(((#showTopProcess# = 1) || (#showCpuFan# = 1) || (#showCpuClock# = 1)) ? ((#showLineGraph# = 1) ? #barTextOffset# : -#contentMarginAbs#) : ((#showLineGraph# = 1) ? #contentMarginAbs# : -2))R
DynamicVariables=1

[MeterThermalThrottlingHistogram]
Meter=Histogram
MeterStyle=StyleLineGraph
PrimaryColor=#colorTempGraph#,#ttHistogramAlpha#
MeasureName=MeasureCpuTtCalc
Hidden=((#showTt# = 0) || (#showLineGraph# = 0))

 Draw lines from last to first, to improve aesthetics
[MeterLineGraph]
Meter=Line
MeterStyle=StyleLineGraph
X=r
Y=r
LineCount=6
MeasureName=MeasureCpuUsage
MeasureName2=MeasurePageUsage
MeasureName3=MeasureRamUsage
MeasureName4=MeasureCpuTempHwinfoPackage
MeasureName5=MeasureCpuTempCoreTempCore1
MeasureName6=MeasureCpuTempSpeedFanCore1
LineColor=#colorAvgCpu#,(#showAvgCpu# * 255)
LineColor2=#colorPage#,(#showPageFile# * 255)
LineColor3=#colorRam#
LineColor4=#colorTempGraph#,(#showCpuTempGraph# * 255 * (#extProgram# = 1))
LineColor5=#colorTempGraph#,(#showCpuTempGraph# * 255 * ((#extProgram# = 2) || (#extProgram# = 6)))
LineColor6=#colorTempGraph#,(#showCpuTempGraph# * 255 * (#extProgram# = 4))

[MeterTtWarning]
Meter=String
MeterStyle=StyleString | StyleStringCenterAlign
FontColor=255,50,50
FontFace=Roboto Lt
Y=1R
Text="Thermal Throttling is enabled!"
Hidden=1
DynamicVariables=1
ToolTipIcon=Warning
ToolTipTitle="WARNING"
ToolTipText="Your CPU has overheated and subsequently forced itself#CRLF#into a low-power state. Continuous exposure to high#CRLF#temperatures will permanantly damage your computer."

[BackgroundHeight]
Meter=Image
MeterStyle=StyleBackgroundHeight
